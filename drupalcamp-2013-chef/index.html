<!DOCTYPE html><html><head>
<title>chef-drupal.md</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=1024, user-scalable=no">

<!-- Required stylesheet -->
<link rel="stylesheet" href="resources/deck.js/core/deck.core.css">

<!-- Extension CSS files go here. Remove or add as needed. -->
<link rel="stylesheet" href="resources/deck.js/extensions/goto/deck.goto.css">
<link rel="stylesheet" href="resources/deck.js/extensions/menu/deck.menu.css">
<link rel="stylesheet" href="resources/deck.js/extensions/navigation/deck.navigation.css">
<link rel="stylesheet" href="resources/deck.js/extensions/status/deck.status.css">
<link rel="stylesheet" href="resources/deck.js/extensions/hash/deck.hash.css">
<link rel="stylesheet" href="resources/deck.js/extensions/scale/deck.scale.css">
<!-- Style theme. More available in /themes/style/ or create your own. -->
<link rel="stylesheet" href="resources/amir-deck.css">

<!-- Transition theme. More available in /themes/transition/ or create your own. -->
<link rel="stylesheet" href="resources/deck.js/themes/transition/vertical-slide.css">

<!-- Required Modernizr file -->
<script src="resources/deck.js/modernizr.custom.js"></script>

<!-- Roboto Slab typeface -->
<link href='http://fonts.googleapis.com/css?family=Roboto+Slab:300,700' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Cardo:400,400italic,700' rel='stylesheet' type='text/css'>
<!-- Google Code Prettify -->
<link rel="stylesheet" href="resources/google-code-prettify/styles/desert.css">
</head><body class='deck-container'><section class='slide'>
<h2 style="margin:100px auto;font-size:2.2em; font-weight:bold;">
  Cooking Drupal with Chef
</h2>

<div style="position: absolute; width:900px; bottom:1em;right:1em;">
  <img src="resources/img/ew-good.png" style="height:130px; float:right;">
  <code style="float:right; font-size:0.7em;">
    <div style="font-size:1.2em; font-weight:bold;">Amir Kadivar </div>
    <div> amir@evolvingweb.ca </div>
    <div> github.com/amirkdv </div>
  </code>
</div>

</section><section class="slide">

<h2>Outline</h2>

<ul>
<li class="slide">Automated Infrastructure: Problem Definition </li>
<li class="slide">Virtualization</li>
<li class="slide">Configuration Management</li>
<li class="slide">Chef</li>
<li class="slide">Chef for Drupal</li>
</ul>

</section><section class="slide">

<h2>Problem Definition</h2>

<h3>development environments</h3>

<ul>
<li class="slide">consistency (with production and other devs)</li>
<li class="slide">choice of tools (limiting developers)</li>
<li class="slide">multiple platforms</li>
</ul>

<h3>testing and integration</h3>

<ul>
<li class="slide">is every commit tested?</li>
<li class="slide">test environment (testing a web application leaves a lot of cruft)</li>
</ul>

<h3>deployment</h3>

<ul>
<li class="slide">how do you go from zero to live site?</li>
<li class="slide">how frequent are changes pushed to production?</li>
</ul>

</section><section class="slide">

<h2>Enters Virtualization</h2>

<ul>
<li class="slide">processes sharing hardware â†’ O/S s sharing hardware</li>
<li class="slide">A VM is an <em>environment</em> that a VM Monitor creates</li>
<li class="slide">These <em>environments</em> should, ideally, be:
<ul>
<li class="slide">isolated from each other</li>
<li class="slide">equivalent to a real machine</li>
<li class="slide">as efficient as a real machine</li>
</ul></li>
<li class="slide">We have achieved all of these!</li>
</ul>

</section><section class="slide">

<h2>Virtualization Technologies</h2>

<ul>
<li class="slide">Types of VM Monitors</li>
<li class="slide">Methods of Virtualization</li>
<li class="slide">why is <img src="resources/img/vagrant-w-name.png" style="display:inline; vertical-align:middle;" height="100px;"/> relevant?</li>
</ul>

</section><section class="slide">

<h2>How does Virtualization Help?</h2>

<!-- * VMs are cheap to build and to throw away! -->

<h3>development:</h3>

<ul>
<li class="slide">VM for every project</li>
<li class="slide">VM for each developer</li>
</ul>

<h3>testing &amp; integration:</h3>

<ul>
<li class="slide">spin up throwaway VM for tests, as frequently as you wish</li>
</ul>

<h3>deployment:</h3>

<ul>
<li class="slide">crufty prod? start from fresh VM</li>
<li class="slide">switch platform? start from fresh VM</li>
</ul>

</section><section class="slide">

<h2>Missing Piece: Provisioning</h2>

<h3>VMs are cheap but:</h3>

<ul>
<li class="slide">how much work is it to configure a VM from <em>scratch</em>?</li>
<li class="slide"><div style="font-size:0.9em;">
how much of this work is reusable for a similar
<em>but not identical</em> use case?</div></li>
<li class="slide"><div style="font-size:0.9em;">
how do you maintain <em>consistent</em> configuration
accross different machines?
</div></li>
</ul>

</section><section class="slide">

<h2>Config Management tools</h2>

<ul>
<li class="slide">Config described in a programming (instead of human) language:
<ul>
<li class="slide">version control</li>
<li class="slide">reusable</li>
</ul></li>
<li class="slide">High level programming language instead of shell scripts
<ul>
<li class="slide">cross-platform configuration</li>
<li class="slide">more readable/maintainable</li>
</ul></li>
</ul>

</section><section class="slide">

<h3><img src="resources/img/chef.png" width="400px"/></h3>

<ul>
<li class="slide">What is it exactly?</li>
<li class="slide">Concepts:
<ul>
<li class="slide">State</li>
<li class="slide">Resources</li>
<li class="slide">Idempotence</li>
</ul></li>
</ul>

</section><section class="slide">

<h2>How does <img src="resources/img/chef-logo.png" style="display:inline; vertical-align:middle; margin:0;" height="150px;"/> work?</h2>

<ul>
<li class="slide">Recipes and Cookbooks</li>
<li class="slide">Run Lists</li>
<li class="slide">Attributes</li>
<li class="slide">Assets: Files and Templates</li>
<li class="slide">Nodes and C/S Chef</li>
</ul>

</section><section class="slide">

<h2>Ruby</h2>

<pre class="prettyprint"><code style="font-family=source code pro;"class="language-ruby">
# a function
def double (x)
  return 2*x
end 

puts double 12 # =&gt; 24
</code></pre>

</section><section class="slide">

<h2>Ruby</h2>

<pre class="prettyprint"><code style="font-family=source code pro;"class="language-ruby"> 
if File.exists? '/foo/bar.php'
  puts "found it"
end

puts "found it" if File.exists? 'foo'
</code></pre>

</section><section class="slide">

<h2>Ruby</h2>

<pre class="prettyprint"><code style="font-family=source code pro;"class="language-ruby">
['John','Mary', 'Bob'].each do |guest|
  puts 'Pleased to meet you #{guest}!'
end
</code></pre>

</section><section class="slide">

<h2><img src="resources/img/chef-logo.png" style="display:inline; vertical-align:middle; margin:0;" height="150px;"/>Resources</h2>

<pre class="prettyprint"><code style="font-family=source code pro;"class="language-ruby">
directory "/path/to/some/directory" do
  owner "user1"
  group "group1"
end
</code></pre>

</section><section class="slide">

<h2><img src="resources/img/chef-logo.png" style="display:inline; vertical-align:middle; margin:0;" height="150px;"/>Resources</h2>

<pre class="prettyprint"><code style="font-family=source code pro;"class="language-ruby">
execute "some-task" do
  cwd "/path/to/some/directory"
  command "command --with-some options"
  creates "/path/to/some/file"
end
</code></pre>

</section><section class="slide">

<h2><img src="resources/img/chef-logo.png" style="display:inline; vertical-align:middle; margin:0;" height="150px;"/>an idempotent resource</h2>

<p><div style="font-size:0.6em"></p>

<pre class="prettyprint"><code style="font-family=source code pro;"class="language-ruby">
execute "my-important-file" do
  command "cp -Rf /vagrant/. #{node['drupal-camp']['the-directory']}/"
  creates node['drupal-camp']['the-directory'] + "/foo.txt"
end
</code></pre>

</section><section class="slide">

<h2><img src="resources/img/chef-logo.png" style="display:inline; vertical-align:middle; margin:0;" height="150px;"/>Attributes</h2>

<pre class="prettyprint"><code style="font-family=source code pro;"class="language-json">
  {
    "mysql": {
      "server_root_password": "root",
    },
    "apache2":{
      "listen_ports": ["80","8000"]
    }
  }
</code></pre>

</section><section class="slide">

<h2><img src="resources/img/chef-logo.png" style="display:inline; vertical-align:middle; margin:0;" height="150px;"/>Templates</h2>

<p><div style="font-size:0.6em"></p>

<pre class="prettyprint"><code style="font-family=source code pro;"class="language-ruby">
template "/path/to/install/foo.sh" do
  source "foo.sh.erb"
  variables({
    :user =&gt; node['apache']['user'], # =&gt; www-data
    :group =&gt; node['deploy']['dev_group'], # =&gt; sysadmin
  })
end
</code></pre>

</section><section class="slide">

<h2><img src="resources/img/chef-logo.png" style="display:inline; vertical-align:middle; margin:0;" height="150px;"/>Templates</h2>

<p><code>my_template.sh.erb</code>:</p>

<pre class="prettyprint"><code style="font-family=source code pro;"class="language-bash">
# script generated by Chef
#! /bin/bash
chown &lt;%= @user %&gt;:&lt;%= @group %&gt; /var/www
</code></pre>

<p><code>/path/to/install/foo.sh</code>:</p>

<pre class="prettyprint"><code style="font-family=source code pro;"class="language-bash">
# script generated by Chef
#! /bin/bash
chown www-data:sysadmin /var/www
</code></pre>

</section><section class="slide">

<h2>Let's see a simple Chef Run</h2>

</section><section class="slide">

<h2><img src="resources/img/chef-logo.png" style="display:inline; vertical-align:middle;"height="250px;"/> + <img src="resources/img/drupal.png" style="vertical-align:middle;display:inline;"height="250px;"/></h2>

<h3>Platform configuration</h3>

<ul>
<li class="slide">HTTP Server(s)</li>
<li class="slide">Database</li>
<li class="slide">PHP</li>
<li class="slide">APC, memcached, Search, Reverse Proxy, Firewall, ...</li>
</ul>

<h3>Drupal configuration</h3>

<ul>
<li class="slide">download Drupal and connect to database</li>
<li class="slide">deploy existing project (codebase + database data)</li>
<li class="slide">manage modules</li>
</ul>

</section><section class="slide">

<h2>Case Studies</h2>

<h3>deploy-drupal</h3>

<p><a href="http://github.com/evolvingweb/chef-deploy-drupal">github.com/evolvingweb/chef-deploy-drupal</a></p>

<h3>drupal-solr</h3>

<p><a href="http://github.com/evolvingweb/chef-drupal-solr">github.com/evolvingweb/chef-drupal-solr</a></p>

</section><section class="slide">

<h1>Thank You!</h1>

</section><section class="slide">
</section>
<!-- End slides. -->


<!-- Begin extension snippets. Add or remove as needed. -->

<!-- deck.navigation snippet -->
<a href="resources/#" class="deck-prev-link" title="Previous">&#8592;</a>
<a href="resources/#" class="deck-next-link" title="Next">&#8594;</a>

<!-- deck.status snippet -->
<p class="deck-status">
	<span class="deck-status-current"></span>
	/
	<span class="deck-status-total"></span>
</p>

<!-- deck.goto snippet -->
<form action="." method="get" class="goto-form">
	<label for="goto-slide">Go to slide:</label>
	<input type="text" name="slidenum" id="goto-slide" list="goto-datalist">
	<datalist id="goto-datalist"></datalist>
	<input type="submit" value="Go">
</form>

<!-- deck.hash snippet -->
<a href="resources/." title="Permalink to this slide" class="deck-permalink">#</a>

<!-- End extension snippets. -->


<!-- Required JS files. -->
<script src="resources/deck.js/jquery-1.7.2.min.js"></script>
<script src="resources/deck.js/core/deck.core.js"></script>

<!-- Extension JS files. Add or remove as needed. -->
<script src="resources/deck.js/deck.js/core/deck.core.js"></script>
<script src="resources/deck.js/extensions/hash/deck.hash.js"></script>
<script src="resources/deck.js/extensions/menu/deck.menu.js"></script>
<script src="resources/deck.js/extensions/goto/deck.goto.js"></script>
<script src="resources/deck.js/extensions/status/deck.status.js"></script>
<script src="resources/deck.js/extensions/navigation/deck.navigation.js"></script>
<script src="resources/deck.js/extensions/scale/deck.scale.js"></script>

<!-- Initialize the deck. You can put this in an external file if desired. -->
<script>
	$(function() {
		$.deck('.slide');
	});
</script>
<script src="resources/google-code-prettify/src/run_prettify.js"></script>
</body></html>
